<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard D3.js Integrado</title>
<!-- D3 v7 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>

<style>
    /* ---------- Base ---------- */
    *{margin:0;padding:0;box-sizing:border-box}
    body{
        font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
        background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
        min-height:100vh;padding:20px
    }
    .dashboard{
        max-width:1400px;margin:auto;
        background:rgba(255,255,255,.95);
        border-radius:20px;padding:30px;
        box-shadow:0 20px 40px rgba(0,0,0,.1);
        backdrop-filter:blur(10px)
    }
    .header{text-align:center;margin-bottom:40px;color:#2c3e50}
    .header h1{
        font-size:2.5em;font-weight:300;margin-bottom:10px;
        background:linear-gradient(45deg,#667eea,#764ba2);
        -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text
    }
    /* ---------- Stat cards ---------- */
    .stats-grid{
        display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
        gap:20px;margin-bottom:40px
    }
    .stat-card{
        background:linear-gradient(135deg,#667eea,#764ba2);
        color:#fff;padding:25px;border-radius:15px;text-align:center;
        transform:translateY(0);transition:.3s;
        box-shadow:0 10px 20px rgba(0,0,0,.1)
    }
    .stat-card:hover{transform:translateY(-5px);box-shadow:0 15px 30px rgba(0,0,0,.15)}
    .stat-value{font-size:2.5em;font-weight:bold;margin-bottom:5px}
    .stat-label{font-size:.9em;opacity:.9;text-transform:uppercase;letter-spacing:1px}
    /* ---------- Charts ---------- */
    .charts-grid{
        display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
        gap:30px;margin-bottom:30px
    }
    .chart-container{
        background:#fff;border-radius:15px;padding:25px;
        box-shadow:0 10px 25px rgba(0,0,0,.08);transition:.3s
    }
    .chart-container:hover{transform:translateY(-2px)}
    .chart-title{
        font-size:1.3em;font-weight:600;color:#2c3e50;
        margin-bottom:20px;text-align:center
    }
    .full-width{grid-column:1/-1}
    .tooltip{
        position:absolute;background:rgba(0,0,0,.8);color:#fff;padding:10px;border-radius:8px;
        font-size:12px;pointer-events:none;opacity:0;transition:opacity .3s;z-index:1000
    }
    .axis{font-size:12px}
    .bar{transition:.3s}.bar:hover{opacity:.7}
    .line{fill:none;stroke-width:3;stroke:#667eea}
    .dot{fill:#667eea;stroke:#fff;stroke-width:2}
    .arc{transition:.3s}.arc:hover{opacity:.8}

    @media(max-width:768px){
        .charts-grid{grid-template-columns:1fr}
        .dashboard{padding:20px}
        .header h1{font-size:2em}
    }
</style>
</head>
<body>
<div class="dashboard">
    <div class="header">
        <h1>📊 Dashboard Interactivo</h1>
        <p>Visualización de datos con D3.js</p>
    </div>

    <!-- ----- Stat cards ----- -->
    <div class="stats-grid" id="stats"></div>

    <!-- ----- Gráficas ----- -->
    <div class="charts-grid">

        <!-- Bar -->
        <div class="chart-container">
            <div class="chart-title">📈 Ventas por Mes</div>
            <div id="barChart"></div>
        </div>

        <!-- Pie -->
        <div class="chart-container">
            <div class="chart-title">🥧 Distribución por Categoría</div>
            <div id="pieChart"></div>
        </div>

        <!-- Line -->
        <div class="chart-container full-width">
            <div class="chart-title">📊 Tendencia de Usuarios</div>
            <div id="lineChart"></div>
        </div>

        <!-- Drag & Drop -->
        <div class="chart-container">
            <div class="chart-title">🎯 Drag & Drop</div>
            <svg id="dragdrop" width="600" height="200" style="background:lightgrey;border-radius:8px"></svg>
        </div>

        <!-- Lissajous -->
        <div class="chart-container">
            <div class="chart-title">🌀 Curva de Lissajous</div>
            <svg id="lissajous" width="300" height="300" style="background:lightgrey;border-radius:8px"></svg>
        </div>

        <!-- Mouse coords -->
        <div class="chart-container">
            <div class="chart-title">📍 Coordenadas del Mouse</div>
            <svg id="coords" width="300" height="300" style="background:lightgrey;border-radius:8px;cursor:crosshair"></svg>
        </div>

        <!-- Stagger -->
        <div class="chart-container">
            <div class="chart-title">📊 Barras Stagger</div>
            <svg id="stagger" width="600" height="300" style="background:lightgrey;border-radius:8px"></svg>
        </div>

    </div><!-- /charts-grid -->
</div><!-- /dashboard -->

<div class="tooltip" id="tooltip"></div>

<script>
/* ========= Datos de ejemplo ========= */
const salesData = [
    {month:'Ene',sales:45000,users:1200},
    {month:'Feb',sales:52000,users:1350},
    {month:'Mar',sales:48000,users:1280},
    {month:'Abr',sales:61000,users:1450},
    {month:'May',sales:55000,users:1380},
    {month:'Jun',sales:67000,users:1520}
];
const categoryData=[
    {category:'Electrónicos',value:35,color:'#667eea'},
    {category:'Ropa',value:25,color:'#764ba2'},
    {category:'Hogar',value:20,color:'#f093fb'},
    {category:'Deportes',value:12,color:'#f5576c'},
    {category:'Otros',value:8,color:'#4facfe'}
];

/* ========= Tooltip helpers ========= */
const tooltip=d3.select('#tooltip');
function showTooltip(event,html){
    tooltip.style('opacity',1)
           .html(html)
           .style('left',(event.pageX+10)+'px')
           .style('top',(event.pageY-10)+'px');
}
function hideTooltip(){tooltip.style('opacity',0)}

/* ========= Stat cards ========= */
function createStatsCards(){
    const stats=[
        {label:'Ventas Totales',value:'$328K',icon:'💰'},
        {label:'Usuarios Activos',value:'8.2K',icon:'👥'},
        {label:'Productos',value:'1 247',icon:'📦'},
        {label:'Conversión',value:'3.2%',icon:'📈'}
    ];
    const cards=d3.select('#stats').selectAll('.stat-card')
        .data(stats).enter().append('div')
        .attr('class','stat-card')
        .style('opacity',0).style('transform','translateY(20px)');

    cards.append('div').attr('class','stat-value').text(d=>d.value);
    cards.append('div').attr('class','stat-label').text(d=>`${d.icon} ${d.label}`);

    cards.transition().duration(800).delay((d,i)=>i*100)
        .style('opacity',1).style('transform','translateY(0)');
}

/* ========= Bar chart ========= */
function createBarChart(){
    const m={top:20,right:30,bottom:40,left:60},
          w=400-m.left-m.right,
          h=300-m.top-m.bottom;

    const svg=d3.select('#barChart').append('svg')
        .attr('width',w+m.left+m.right).attr('height',h+m.top+m.bottom);

    const g=svg.append('g').attr('transform',`translate(${m.left},${m.top})`);

    const x=d3.scaleBand().domain(salesData.map(d=>d.month)).range([0,w]).padding(.2),
          y=d3.scaleLinear().domain([0,d3.max(salesData,d=>d.sales)]).range([h,0]);

    g.append('g').attr('class','axis').attr('transform',`translate(0,${h})`).call(d3.axisBottom(x));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).tickFormat(d=>`$${d/1000}K`));

    /* Gradiente */
    const defs=svg.append('defs');
    const grad=defs.append('linearGradient').attr('id','barGradient')
        .attr('gradientUnits','userSpaceOnUse').attr('x1',0).attr('y1',h).attr('x2',0).attr('y2',0);
    grad.append('stop').attr('offset','0%').attr('stop-color','#667eea');
    grad.append('stop').attr('offset','100%').attr('stop-color','#764ba2');

    const bars=g.selectAll('.bar').data(salesData).enter().append('rect')
        .attr('class','bar').attr('x',d=>x(d.month)).attr('width',x.bandwidth())
        .attr('y',h).attr('height',0).attr('fill','url(#barGradient)')
        .on('mouseover',(e,d)=>showTooltip(e,`<strong>${d.month}</strong><br>Ventas: $${d.sales.toLocaleString()}`))
        .on('mouseout',hideTooltip);

    bars.transition().duration(800).delay((d,i)=>i*100)
        .attr('y',d=>y(d.sales)).attr('height',d=>h-y(d.sales));
}

/* ========= Pie chart ========= */
function createPieChart(){
    const w=350,h=300,r=Math.min(w,h)/2-20;
    const svg=d3.select('#pieChart').append('svg').attr('width',w).attr('height',h);
    const g=svg.append('g').attr('transform',`translate(${w/2},${h/2})`);
    const pie=d3.pie().value(d=>d.value).sort(null);
    const arc=d3.arc().innerRadius(r*.4).outerRadius(r),
          arcHover=d3.arc().innerRadius(r*.4).outerRadius(r*1.1);

    const arcs=g.selectAll('.arc').data(pie(categoryData)).enter().append('g').attr('class','arc');

    arcs.append('path')
        .attr('d',arc).attr('fill',d=>d.data.color).style('opacity',0)
        .on('mouseover',function(e,d){
            d3.select(this).transition().duration(200).attr('d',arcHover);
            showTooltip(e,`<strong>${d.data.category}</strong><br>${d.data.value}%`);
        })
        .on('mouseout',function(){d3.select(this).transition().duration(200).attr('d',arc);hideTooltip()})
        .transition().duration(800).delay((d,i)=>i*100).style('opacity',1);

    arcs.append('text')
        .attr('transform',d=>`translate(${arc.centroid(d)})`)
        .attr('text-anchor','middle').style('font-size','12px').style('font-weight','bold')
        .style('fill','#fff').style('opacity',0)
        .text(d=>d.data.value+'%')
        .transition().duration(800).delay((d,i)=>i*100+400).style('opacity',1);
}

/* ========= Line chart ========= */
function createLineChart(){
    const m={top:20,right:30,bottom:40,left:60},
          w=800-m.left-m.right,
          h=300-m.top-m.bottom;

    const svg=d3.select('#lineChart').append('svg')
        .attr('width',w+m.left+m.right).attr('height',h+m.top+m.bottom);
    const g=svg.append('g').attr('transform',`translate(${m.left},${m.top})`);

    const x=d3.scaleBand().domain(salesData.map(d=>d.month)).range([0,w]).padding(.1),
          y=d3.scaleLinear().domain([0,d3.max(salesData,d=>d.users)]).range([h,0]);

    g.append('g').attr('class','axis').attr('transform',`translate(0,${h})`).call(d3.axisBottom(x));
    g.append('g').attr('class','axis').call(d3.axisLeft(y));

    /* Área con gradiente */
    const defs=svg.append('defs');
    const areaGrad=defs.append('linearGradient').attr('id','areaGradient')
        .attr('gradientUnits','userSpaceOnUse').attr('x1',0).attr('y1',h).attr('x2',0).attr('y2',0);
    areaGrad.append('stop').attr('offset','0%').attr('stop-color','#667eea').attr('stop-opacity',0);
    areaGrad.append('stop').attr('offset','100%').attr('stop-color','#667eea').attr('stop-opacity',.8);

    const area=d3.area()
        .x(d=>x(d.month)+x.bandwidth()/2).y0(h).y1(d=>y(d.users)).curve(d3.curveMonotoneX);
    g.append('path').datum(salesData).attr('fill','url(#areaGradient)').attr('opacity',.3).attr('d',area);

    const line=d3.line()
        .x(d=>x(d.month)+x.bandwidth()/2).y(d=>y(d.users)).curve(d3.curveMonotoneX);

    const path=g.append('path').datum(salesData).attr('class','line').attr('d',line);
    const totalLen=path.node().getTotalLength();
    path.attr('stroke-dasharray',`${totalLen} ${totalLen}`).attr('stroke-dashoffset',totalLen)
        .transition().duration(2000).attr('stroke-dashoffset',0);

    g.selectAll('.dot').data(salesData).enter().append('circle')
        .attr('class','dot').attr('cx',d=>x(d.month)+x.bandwidth()/2)
        .attr('cy',d=>y(d.users)).attr('r',0)
        .on('mouseover',(e,d)=>{
            d3.select(e.currentTarget).transition().duration(100).attr('r',8);
            showTooltip(e,`<strong>${d.month}</strong><br>Usuarios: ${d.users.toLocaleString()}`);
        })
        .on('mouseout',function(e){
            d3.select(this).transition().duration(100).attr('r',5);
            hideTooltip();
        })
        .transition().delay(2000).attr('r',5);
}

/* ========= Demo 1: Drag & Drop ========= */
function makeDragDrop(){
    /* círculos iniciales */
    const svg=d3.select('#dragdrop');
    [{cx:100,fill:'red'},{cx:300,fill:'green'},{cx:500,fill:'blue'}].forEach(d=>{
        svg.append('circle').attr('cx',d.cx).attr('cy',100).attr('r',20).attr('fill',d.fill);
    });

    let widget,color;
    const drag=d3.drag()
        .on('start',(event,d)=>{
            color=d3.select(event.sourceEvent.target).attr('fill');
            widget=d3.select(event.sourceEvent.target).attr('fill','lime');
        })
        .on('drag',(event,d)=>{
            const [x,y]=d3.pointer(event,svg.node());
            widget.attr('cx',x).attr('cy',y);
        })
        .on('end',()=>widget && widget.attr('fill',color));

    drag(svg.selectAll('circle'));
}

/* ========= Demo 2: Lissajous ========= */
function makeLissajous(){
    const svg=d3.select('#lissajous');
    const a=1.9,b=3.2,omega=2*Math.PI/10000; // 10 s por período
    let [prevX,prevY]=[250,150]; // punto inicial
    const timer=d3.timer(t=>{
        const phi=omega*t,
              x=150+100*Math.cos(a*phi)+100,
              y=150+100*Math.sin(b*phi);
        /* desvanecer trazos antiguos */
        svg.selectAll('line')
            .each(function(){this._op*=.99})
            .attr('stroke-opacity',function(){return this._op})
            .filter(function(){return this._op<.05}).remove();
        svg.append('line')
            .each(function(){this._op=1})
            .attr('x1',prevX).attr('y1',prevY)
            .attr('x2',x).attr('y2',y)
            .attr('stroke','green').attr('stroke-width',2);
        [prevX,prevY]=[x,y];
        if(t>120e3) timer.stop();
    });
}

/* ========= Demo 3: Mouse coords ========= */
function coordsPixels(selector){
    const svg=d3.select(selector);
    const txt=svg.append('text').attr('fill','#000').attr('font-size','14px');
    svg.on('mousemove',event=>{
        const [x,y]=d3.pointer(event,svg.node());
        txt.attr('x',x+18).attr('y',y+6).text(`${Math.round(x)}, ${Math.round(y)}`);
    });
}

/* ========= Demo 4: Stagger ========= */
function makeStagger(){
    let ds1=[2,1,3,5,7,8,9,9,9,8,7,5,3,1,2],
        ds2=[8,9,8,7,5,3,2,1,2,3,5,7,8,9,8];
    const n=ds1.length,mx=d3.max([...ds1,...ds2]);
    const svg=d3.select('#stagger');

    const scX=d3.scaleLinear().domain([0,n]).range([50,540]),
          scY=d3.scaleLinear().domain([0,mx]).range([250,50]);

    svg.selectAll('line').data(ds1).enter().append('line')
        .attr('stroke','red').attr('stroke-width',20)
        .attr('x1',(d,i)=>scX(i)).attr('y1',scY(0))
        .attr('x2',(d,i)=>scX(i)).attr('y2',d=>scY(d));

    svg.on('click',()=>{
        [ds1,ds2]=[ds2,ds1];
        svg.selectAll('line').data(ds1)
            .transition().duration(1000).delay((d,i)=>200*i)
            .attr('y2',d=>scY(d));
    });
}

/* ========= Lanzar todo ========= */
createStatsCards();
createBarChart();
createPieChart();
createLineChart();
makeDragDrop();
makeLissajous();
coordsPixels('#coords');
makeStagger();
</script>
</body>
</html>

